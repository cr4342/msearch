# 项目任务列表

建议按顺序/优先级完成以下任务：

## 项目概述
msearch 是一款**单机可运行**的跨平台多模态桌面检索软件，专为视频剪辑师设计，实现素材无需整理、无需标签的智能检索。该软件基于专业化多模型架构，结合 inaSpeechSegmenter 进行音频内容智能分类，支持文本、图像、视频、音频四种模态的精准检索，通过实时监控和增量处理，为视频剪辑师提供高效、安全的多媒体内容检索体验。

## 核心架构
- 单进程多线程架构（支持多进程架构）
- 线程池管理（Embedding Pool, I/O Pool, Task Pool）
- SQLite 任务队列实现
- Infinity 模型管理框架
- 多模态嵌入（文本、图像、视频、音频）
- 向量存储与 LanceDB
- 文件监控与 Watchdog
- 实时目录监控和增量索引
- 媒体预处理（视频切片、音频重采样）
- 任务优先级系统（0-11级）
- RESTful API 与 FastAPI
- WebUI 与 Gradio
- 桌面 UI 与 PySide6

## 项目结构

### 核心组件层 (src/core/)
- **config/**: 配置管理
- **database/**: 数据库管理
- **vector/**: 向量存储
- **embedding/**: 向量化引擎
- **task/**: 任务管理
- **hardware/**: 硬件检测
- **logging/**: 日志配置

### 服务层 (src/services/)
- **search/**: 检索服务
- **media/**: 媒体处理服务
- **file/**: 文件处理服务
- **face/**: 人脸识别服务（可选）
- **cache/**: 缓存服务

### 数据层 (src/data/)
- **extractors/**: 数据提取器
- **generators/**: 数据生成器
- **models/**: 数据模型定义
- **validators/**: 数据验证器

### 工具层 (src/utils/)
- **error_handling.py**: 错误处理
- **exceptions.py**: 异常定义
- **retry.py**: 重试策略
- **helpers.py**: 辅助函数
- **file_utils.py**: 文件操作工具

### API层 (src/api/)
- **v1/**: API v1版本
- **middlewares.py**: API中间件

## 任务列表

### 1. 核心功能任务

#### 1.1 多模态检索功能
- [x] 实现文字混合检索（支持文搜图、文搜视频、文搜音频）
- [x] 实现图搜图、图搜视频功能
- [x] 实现音频找相似音频、找包含相似音频的视频功能
- [x] 实现人脸识别与基于人名的检索（可选功能）
- [x] 实现视频时序定位功能

#### 1.2 媒体预处理
- [x] 实现智能视频预处理（格式优化、内存保护、性能优化）
- [x] 实现智能图像预处理（格式优化、内存保护、IO优化）
- [x] 实现智能音频预处理（格式优化、内存保护、音频价值判断）

#### 1.3 文件管理与监控
- [x] 实现目录监控与自动处理功能
- [x] 实现重复文件检测与引用功能
- [x] 实现手动操作控制与进度管理功能

### 2. 系统架构任务

#### 2.1 核心架构
- [x] 实现单进程多线程架构
- [x] 设计并实现线程池管理系统
- [x] 实现 SQLite 任务队列
- [x] 集成 Infinity 模型管理框架
- [x] 实现向量存储与 LanceDB 集成

#### 2.2 任务管理
- [x] 实现任务优先级系统（0-11级）
- [x] 实现任务调度机制
- [x] 实现任务依赖管理
- [x] 实现任务持久化

#### 2.3 缓存与优化
- [x] 实现缓存策略（LRU、LFU、TTL）
- [x] 实现噪音过滤机制
- [x] 实现硬件自适应模型选择

### 3. API 与服务

#### 3.1 API 服务器
- [x] 实现 RESTful API 与 FastAPI
- [x] 实现健康检查端点
- [x] 实现 API 路由系统
- [x] 实现任务管理 API
- [x] 实现搜索 API

#### 3.2 服务组件
- [x] 实现任务管理器
- [x] 实现文件索引器
- [x] 实现数据库管理器
- [x] 实现向量存储管理器
- [x] 实现配置管理器
- [x] 实现日志系统
- [x] 实现硬件检测服务

### 4. 用户界面

#### 4.1 WebUI
- [x] 实现 Gradio WebUI
- [x] 实现 API 客户端
- [x] 实现搜索界面
- [x] 实现任务管理界面
- [x] 实现目录监控可视化界面

#### 4.2 桌面 UI
- [x] 实现 PySide6 桌面 UI
- [x] 实现桌面搜索界面
- [x] 实现桌面任务管理界面
- [x] 实现桌面目录监控界面

### 5. 文档与测试

#### 5.1 文档
- [x] 更新设计文档（design.md）
- [x] 撰写需求文档（requirements.md）
- [x] 更新任务列表（tasks.md）
- [x] 参与完成数据流转总览（data_flow.md）
- [x] 完成文件扫描系统详细设计（file_scanner_design_refinement.md）
- [x] 完成部署与运维（deployment.md）
- [x] 补充完整设计文档（COMPLETE_DOCUMENTATION.md）
- [x] 完成桌面 UI 系统设计（pyside6_ui_design.md）
- [x] 更新用户手册（user_manual.md）
- [x] 将设计文档（设计 & 需求 & 任务）分类归档到 docs/ 目录
- [x] 完成所有设计文档
- [x] 更新 README.md，补充各文档的链接
- [x] 更新 IFLOW.md 文档，补充各模块与文档之间的关系
- [x] 完成所有设计文档、需求文档、任务列表
- [x] 梳理并补充 README.md 中的文档与项目结构

#### 5.2 测试
- [x] 实现单元测试
- [x] 实现集成测试
- [x] 实现端到端测试
- [x] 实现性能基准测试
- [x] 生成覆盖率报告

### 6. 部署与运维

#### 6.1 部署
- [x] 实现部署脚本
- [x] 实现配置管理
- [x] 实现日志管理
- [x] 实现监控系统

#### 6.2 运维
- [x] 实现系统监控
- [x] 实现告警系统
- [x] 实现备份与恢复
- [x] 实现性能优化

### 7. 功能增强

#### 7.1 搜索功能
- [x] 实现文本搜索
- [x] 实现图像搜索
- [x] 实现视频搜索
- [x] 实现音频搜索
- [x] 实现混合搜索

#### 7.2 索引功能
- [x] 实现文件索引
- [x] 实现目录索引
- [x] 实现增量索引
- [x] 实现索引优化

#### 7.3 任务管理
- [x] 实现任务创建
- [x] 实现任务执行
- [x] 实现任务监控
- [x] 实现任务取消
- [x] 实现任务优先级

### 8. 性能优化

#### 8.1 嵌入优化
- [x] 实现批量嵌入
- [x] 实现缓存机制
- [x] 实现模型优化

#### 8.2 搜索优化
- [x] 实现向量索引优化
- [x] 实现搜索算法优化
- [x] 实现结果排序优化

#### 8.3 系统优化
- [x] 实现内存管理优化
- [x] 实现磁盘 I/O 优化
- [x] 实现网络优化

### 9. 安全与稳定性

#### 9.1 安全
- [x] 实现 API 认证
- [x] 实现数据加密
- [x] 实现访问控制
- [x] 实现本地运行与数据安全

#### 9.2 稳定性
- [x] 实现错误处理
- [x] 实现异常恢复
- [x] 实现系统监控
- [x] 实现后端与前端UI分离

## 任务优先级

任务优先级分为 12 级（0-11），其中 0 为最高优先级，11 为最低优先级。

### 优先级分配
- **0-2**：核心系统任务（如启动、初始化）
- **3-5**：用户交互任务（如搜索请求）
- **6-8**：索引任务（如文件索引）
- **9-11**：后台维护任务（如清理、优化）

### 自动优先级分配
- [x] 向量化任务：最高优先级（1-5级）
- [x] 预处理任务：中等优先级（6-8级）
- [x] 缩略图生成任务：较低优先级（9-10级）
- [x] 预览生成任务：较低优先级（9-10级）

### 用户控制优先级
- [x] 支持用户手动设置文件类型优先级
- [x] 支持用户调整任务优先级

## 任务状态

- [x] 已完成
- [ ] 进行中
- [ ] 未开始

## 项目进度

### 核心功能
- [x] 多模态检索功能
- [x] 媒体预处理
- [x] 文件管理与监控

### 系统架构
- [x] 核心架构
- [x] 任务管理
- [x] 缓存与优化

### API 与服务
- [x] API 服务器
- [x] 服务组件

### 用户界面
- [x] WebUI
- [x] 桌面 UI

### 文档与测试
- [x] 文档
- [x] 测试

### 部署与运维
- [x] 部署
- [x] 运维

### 功能增强
- [x] 搜索功能
- [x] 索引功能
- [x] 任务管理

### 性能优化
- [x] 嵌入优化
- [x] 搜索优化
- [x] 系统优化

### 安全与稳定性
- [x] 安全
- [x] 稳定性

## 总结

msearch 项目已完成核心架构和功能实现，包括单进程多线程架构、多模态嵌入、向量存储、文件监控、API 服务器和用户界面等。项目采用优先级系统管理任务，确保核心功能优先执行。

系统支持文本、图像、视频和音频的多模态搜索，提供智能媒体预处理、目录监控、重复文件检测等功能，为视频剪辑师提供高效、安全的多媒体内容检索体验。

后续工作将集中在性能优化、功能增强和运维支持上，以提高系统的稳定性和用户体验。
# 用户手册

> **文档导航**: [文档索引](README.md) | [需求文档](requirements.md) | [设计文档](design.md) | [开发计划](development_plan.md) | [测试策略](test_strategy.md) | [部署指南](deployment_guide.md) | [API文档](api_documentation.md)

## 1. 快速入门

### 1.1 什么是MSearch

MSearch是一款智能多模态检索系统，它能够帮助您快速找到存储在计算机中的图片、视频、音频文件。与传统的文件名搜索不同，MSearch基于文件内容进行智能检索，您可以：

- **用文字描述搜索图片**：输入"夕阳下的海滩"找到相关风景照片
- **用图片搜索相似图片**：上传一张照片找到类似的图片
- **精确定位视频片段**：搜索"会议开始"直接跳转到视频中的具体时间点
- **通过人名搜索**：输入"张三"找到所有包含该人物的照片和视频
- **语音内容搜索**：搜索录音中的对话内容

### 1.2 系统特色

**智能理解内容**：
- 不需要手动添加标签或分类
- 系统自动理解图片、视频、音频的内容
- 支持自然语言描述进行搜索

**精确时间定位**：
- 视频搜索精确到±2秒
- 音频搜索定位到具体时间段
- 支持时间轴可视化浏览

**人脸识别**：
- 预先录入人物信息和照片
- 自动识别照片和视频中的人物
- 支持人名和别名搜索

### 1.3 首次使用

**第一步：启动系统**
```bash
# 启动MSearch服务
python scripts/start.py
```

**第二步：访问界面**
- 打开浏览器访问：http://localhost:8000
- 或使用桌面应用程序（如果已安装）

**第三步：配置监控目录**
1. 点击"设置"按钮
2. 添加要监控的文件夹（如图片文件夹、视频文件夹）
3. 系统将自动扫描和索引这些文件夹中的文件

**第四步：等待索引完成**
- 系统会在后台处理您的文件
- 处理进度可在"任务状态"中查看
- 首次处理可能需要一些时间，请耐心等待

## 2. 基础功能使用

### 2.1 文本搜索

**搜索图片**：
1. 在搜索框中输入描述性文字，如：
   - "美丽的风景"
   - "蓝天白云"
   - "生日聚会"
   - "宠物猫咪"

2. 选择搜索类型为"文本搜索图片"
3. 点击搜索按钮
4. 浏览搜索结果，点击图片可以查看大图

**搜索视频**：
1. 输入场景描述，如：
   - "会议讨论"
   - "户外运动"
   - "家庭聚餐"

2. 选择搜索类型为"文本搜索视频"
3. 搜索结果会显示匹配的视频片段和时间戳
4. 点击时间戳可以直接跳转到视频的对应位置

**搜索音频**：
1. 输入音频内容描述，如：
   - "轻松的音乐"
   - "会议录音"
   - "电话通话"

2. 系统会搜索音频文件和视频中的音频内容
3. 对于语音内容，系统会显示转录的文字

### 2.2 图片搜索

**上传图片搜索**：
1. 点击"图片搜索"标签
2. 拖拽图片到上传区域，或点击选择文件
3. 系统会找到视觉上相似的图片
4. 结果按相似度排序显示

**支持的图片格式**：
- JPEG (.jpg, .jpeg)
- PNG (.png)
- GIF (.gif)
- BMP (.bmp)
- WebP (.webp)
- TIFF (.tiff)

### 2.3 智能搜索

**自动识别查询类型**：
1. 选择"智能搜索"模式
2. 输入任意查询内容
3. 系统会自动判断您的搜索意图：
   - 人名查询：自动启用人脸识别
   - 音频查询：重点搜索音频内容
   - 视觉查询：重点搜索图片和视频

**查询示例**：
- "张三在开会" → 自动识别为人名+场景查询
- "钢琴音乐" → 自动识别为音频查询
- "红色的花朵" → 自动识别为视觉查询

## 3. 高级功能

### 3.1 人脸识别设置

**添加人物信息**：
1. 进入"人脸管理"页面
2. 点击"添加人物"
3. 填写人物信息：
   - 姓名：如"张三"
   - 别名：如"小张"、"张总"（可选）
4. 上传该人物的清晰照片（建议2-3张不同角度）
5. 点击"保存"

**人物照片要求**：
- 人脸清晰可见，无遮挡
- 光线充足，避免过暗或过亮
- 建议正面照和侧面照各一张
- 图片格式：JPG、PNG等常见格式

**使用人名搜索**：
1. 在搜索框输入人名，如"张三"
2. 系统会自动找到包含该人物的所有照片和视频
3. 视频结果会显示该人物出现的具体时间段

### 3.2 时间轴搜索

**按时间范围搜索**：
1. 点击"高级搜索"
2. 设置时间范围：
   - 开始时间：2024-01-01
   - 结束时间：2024-01-31
3. 输入搜索内容
4. 系统只在指定时间范围内搜索

**时间轴浏览**：
1. 搜索结果页面点击"时间轴视图"
2. 可以看到搜索结果在时间轴上的分布
3. 点击时间轴上的点可以快速定位到对应内容

### 3.3 多模态融合搜索

**组合查询**：
1. 选择"融合搜索"模式
2. 可以同时使用：
   - 文字描述
   - 参考图片
   - 音频样本
3. 调整各种模态的权重
4. 获得更精确的搜索结果

**权重调整**：
- 文本权重：50%（重视文字描述）
- 图片权重：30%（重视视觉相似性）
- 音频权重：20%（重视音频相似性）

## 4. 文件管理

### 4.1 监控目录设置

**添加监控目录**：
1. 进入"设置" → "监控目录"
2. 点击"添加目录"
3. 选择要监控的文件夹
4. 设置监控选项：
   - 递归监控：是否监控子文件夹
   - 文件类型：选择要处理的文件类型

**推荐监控目录**：
- 图片：~/Pictures、~/Photos
- 视频：~/Videos、~/Movies
- 音频：~/Music、~/Recordings
- 文档：~/Documents（如果包含多媒体文件）

**自动处理**：
- 新文件添加到监控目录后会自动处理
- 处理进度可在"任务状态"中查看
- 处理完成后即可搜索到新文件

### 4.2 文件状态管理

**查看文件状态**：
1. 进入"文件管理"页面
2. 可以看到所有已索引的文件
3. 文件状态说明：
   - 待处理：文件已发现，等待处理
   - 处理中：正在提取内容和生成索引
   - 已完成：处理完成，可以搜索
   - 处理失败：处理过程中出现错误

**重新处理文件**：
1. 找到处理失败的文件
2. 点击"重新处理"按钮
3. 系统会重新尝试处理该文件

**删除文件索引**：
1. 选择不需要的文件
2. 点击"删除索引"
3. 注意：这只会删除索引，不会删除原始文件

### 4.3 存储空间管理

**查看存储使用情况**：
1. 进入"系统状态"页面
2. 查看存储空间使用情况：
   - 数据库大小
   - 日志文件大小
   - 缓存文件大小

**清理存储空间**：
1. 定期清理旧日志文件
2. 删除不需要的文件索引
3. 清理临时文件和缓存

## 5. 系统设置

### 5.1 基础设置

**日志级别设置**：
- DEBUG：详细调试信息（开发时使用）
- INFO：正常运行信息（推荐）
- WARNING：警告信息
- ERROR：仅错误信息

**性能设置**：
- 并发任务数：根据CPU核心数调整（推荐4-8）
- 批处理大小：根据内存大小调整
- GPU加速：如果有NVIDIA显卡可以启用

### 5.2 搜索设置

**相似度阈值**：
- 范围：0.0-1.0
- 默认：0.3
- 数值越高，搜索结果越严格

**返回结果数量**：
- 默认：10个结果
- 最大：100个结果
- 根据需要调整

**搜索权重**：
可以调整不同模态的搜索权重：
- 视觉权重：图片和视频内容的重要性
- 音频权重：音频内容的重要性
- 文本权重：文本描述的重要性

### 5.3 模型设置

**模型选择**：
- CLIP模型：处理图片和文本
  - 基础版：openai/clip-vit-base-patch32（推荐）
  - 高精度版：openai/clip-vit-large-patch14-336（需要更多资源）
- CLAP模型：处理音频内容
- Whisper模型：语音转文字
  - 基础版：openai/whisper-base（推荐）
  - 高精度版：openai/whisper-large（需要更多资源）

**设备设置**：
- 自动：系统自动选择最佳设备
- CPU：使用CPU处理（兼容性好）
- CUDA：使用NVIDIA GPU加速（性能更好）

## 6. 故障排除

### 6.1 常见问题

**问题：搜索没有结果**
- 检查文件是否已经处理完成
- 尝试调低相似度阈值
- 使用更通用的搜索词汇
- 检查文件格式是否支持

**问题：处理速度很慢**
- 检查CPU和内存使用情况
- 启用GPU加速（如果有NVIDIA显卡）
- 减少并发任务数
- 关闭不必要的其他程序

**问题：人脸识别不准确**
- 确保人脸照片清晰
- 添加更多不同角度的照片
- 检查光线是否充足
- 避免人脸被遮挡

**问题：视频时间戳不准确**
- 检查视频文件是否完整
- 确认视频格式是否支持
- 尝试重新处理该视频文件

### 6.2 性能优化

**硬件优化建议**：
- CPU：推荐8核心以上
- 内存：推荐16GB以上
- 存储：使用SSD可以显著提升性能
- GPU：NVIDIA显卡可以大幅提升处理速度

**软件优化建议**：
- 定期重启系统释放内存
- 关闭不必要的后台程序
- 定期清理临时文件
- 保持系统和驱动程序更新

### 6.3 日志查看

**查看系统日志**：
1. 进入"系统状态"页面
2. 点击"查看日志"
3. 可以看到系统运行日志和错误信息

**日志文件位置**：
- 主日志：data/logs/msearch.log
- 错误日志：data/logs/error.log
- 性能日志：data/logs/performance.log

**日志级别说明**：
- INFO：正常操作信息
- WARNING：警告信息，系统仍可正常运行
- ERROR：错误信息，可能影响部分功能
- CRITICAL：严重错误，可能导致系统停止

## 7. 最佳实践

### 7.1 文件组织建议

**目录结构建议**：
```
~/Media/
├── Photos/
│   ├── 2024/
│   ├── 2023/
│   └── Family/
├── Videos/
│   ├── Meetings/
│   ├── Vacation/
│   └── Projects/
└── Audio/
    ├── Music/
    ├── Recordings/
    └── Podcasts/
```

**文件命名建议**：
- 使用有意义的文件名
- 包含日期信息：2024-01-15_meeting.mp4
- 避免特殊字符和空格
- 使用统一的命名规范

### 7.2 搜索技巧

**有效的搜索词汇**：
- 使用具体的描述词：如"红色汽车"而不是"汽车"
- 包含场景信息：如"办公室会议"、"海边度假"
- 使用情感词汇：如"快乐的聚会"、"安静的风景"

**组合搜索策略**：
- 先用宽泛的词汇搜索，再逐步细化
- 结合人名和场景：如"张三在会议室"
- 使用时间范围缩小搜索范围

### 7.3 系统维护

**定期维护任务**：
- 每周检查系统状态和日志
- 每月清理旧日志文件
- 定期备份重要数据
- 更新系统和模型

**备份建议**：
- 备份配置文件：config/config.yml
- 备份数据库：data/database/
- 备份人脸库数据
- 定期导出搜索历史

## 8. 高级用户指南

### 8.1 API使用

**编程接口**：
MSearch提供完整的REST API，支持：
- 搜索功能集成
- 文件管理操作
- 系统状态监控
- 配置管理

**API文档**：
详细的API文档请参考：[API文档](api_documentation.md)

### 8.2 自定义配置

**配置文件位置**：
- 主配置：config/config.yml
- 日志配置：config/logging.yml

**高级配置选项**：
- 模型参数调优
- 处理流程自定义
- 性能参数优化
- 安全设置配置

### 8.3 扩展功能

**插件支持**：
- 自定义文件处理器
- 扩展搜索算法
- 集成第三方服务

**二次开发**：
- 源代码开放
- 模块化架构
- 详细的开发文档

## 9. 技术支持

### 9.1 获取帮助

**文档资源**：
- [需求文档](requirements.md)：了解系统功能需求
- [设计文档](design.md)：了解系统架构设计
- [部署指南](deployment_guide.md)：系统安装和部署
- [API文档](api_documentation.md)：编程接口说明

**社区支持**：
- GitHub Issues：报告问题和建议
- 用户论坛：经验分享和讨论
- 技术博客：最新功能和技巧

### 9.2 问题反馈

**报告问题时请提供**：
- 系统版本信息
- 操作系统信息
- 详细的问题描述
- 错误日志信息
- 重现问题的步骤

**联系方式**：
- 邮箱：support@msearch.com
- GitHub：https://github.com/your-org/msearch
- 文档网站：https://docs.msearch.com

这个用户手册提供了完整的使用指导，从基础功能到高级特性，帮助用户充分利用MSearch系统的强大功能。
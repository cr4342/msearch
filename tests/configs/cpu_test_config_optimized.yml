# CPU环境优化测试配置
# 针对Python 3.12和资源受限环境优化

# 设备配置
device: "cpu"
force_cpu: true

# 模型配置 - 使用轻量级模型
model:
  # 使用较小的CLIP模型
  clip_model: "openai/clip-vit-base-patch32"
  # 禁用GPU加速的人脸模型
  face_model: "mtcnn"
  # 模型缓存目录
  cache_dir: "./data/models"
  # 启用模型量化以减少内存使用
  quantization: true

# 批处理配置
batch_size: 2  # 减小批处理大小
max_batch_size: 4

# 内存优化配置
memory:
  # 最大内存使用限制 (MB)
  max_memory_mb: 2048
  # 启用内存清理
  enable_gc: true
  # GC触发阈值
  gc_threshold: 100

# 测试数据限制
test_data:
  # 视频时长限制 (秒)
  max_video_duration: 60
  # 图片分辨率限制
  max_image_resolution: [640, 480]
  # 音频时长限制 (秒)
  max_audio_duration: 30
  # 最大文件大小 (MB)
  max_file_size_mb: 50

# 性能基准 - CPU模式
performance_benchmarks:
  # 视频处理速度 (实时倍数)
  video_processing_fps: 0.2
  # 搜索响应时间 (毫秒)
  search_response_time_ms: 1000
  # 内存使用限制 (MB)
  memory_usage_mb: 2048
  # 时间戳精度要求 (秒)
  timestamp_accuracy_s: 2.0

# Qdrant配置
qdrant:
  host: "localhost"
  port: 6333
  # 连接超时
  timeout: 30
  # 重试次数
  max_retries: 3
  # 集合配置
  collection_config:
    # 向量维度
    vector_size: 512
    # 距离度量
    distance: "Cosine"
    # 优化器配置
    optimizers_config:
      # 删除阈值
      deleted_threshold: 0.2
      # 真空最小向量数
      vacuum_min_vector_number: 1000
      # 默认段数
      default_segment_number: 0
      # 最大段大小
      max_segment_size_kb: 5000
      # 内存映射阈值
      memmap_threshold_kb: 1000
      # 索引阈值
      indexing_threshold_kb: 2000
      # 刷新间隔
      flush_interval_sec: 5
      # 最大优化线程数
      max_optimization_threads: 1

# 日志配置
logging:
  level: "INFO"
  # 日志文件
  file: "logs/cpu_test.log"
  # 最大文件大小 (MB)
  max_file_size_mb: 10
  # 备份文件数
  backup_count: 3
  # 日志格式
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# OpenCV配置
opencv:
  # 禁用GUI相关功能
  headless: true
  # 线程数限制
  num_threads: 2
  # 禁用硬件加速
  disable_opencl: true

# 测试超时配置
timeouts:
  # 单个测试超时 (秒)
  test_timeout: 300
  # 服务启动超时 (秒)
  service_startup_timeout: 60
  # 网络请求超时 (秒)
  request_timeout: 30

# 并发配置
concurrency:
  # 最大并发数
  max_workers: 2
  # 线程池大小
  thread_pool_size: 4

# 错误处理配置
error_handling:
  # 最大重试次数
  max_retries: 3
  # 重试间隔 (秒)
  retry_interval: 1
  # 启用详细错误日志
  verbose_errors: true

# 测试环境配置
test_environment:
  # 临时目录
  temp_dir: "/tmp/msearch_test"
  # 测试数据目录
  fixtures_dir: "tests/fixtures"
  # 输出目录
  output_dir: "tests/output"
  # 清理临时文件
  cleanup_temp: true